<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π</title>
    <link rel="stylesheet" href="/css/page.css">
</head>
<body>
<div class="container">
    <h1>üè™ –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π</h1>

    <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'accounts')">üí≥ –°—á–µ—Ç–∞</button>
        <button class="tab" onclick="openTab(event, 'orders')">üì¶ –ó–∞–∫–∞–∑—ã</button>
    </div>

    <div id="accounts" class="tab-content active">
        <div class="grid">
            <div class="card">
                <div class="section">
                    <h3>–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç</h3>
                    <div class="form-group">
                        <label>–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                        <input type="text" id="fullName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</label>
                        <input type="number" id="balance" placeholder="0.00" step="0.01" min="0">
                    </div>
                    <button class="btn" onclick="createAccount()">–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç</button>
                    <div id="createAccountResult" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="section">
                    <h3>–ù–∞–π—Ç–∏ —Å—á–µ—Ç</h3>
                    <div class="form-group">
                        <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="getUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
                    </div>
                    <button class="btn" onclick="getAccount()">–ù–∞–π—Ç–∏ —Å—á–µ—Ç</button>
                    <div id="getAccountResult" class="result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section">
                <h3>–û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</h3>
                <div class="two-column">
                    <div class="form-group">
                        <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="updateUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
                    </div>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è</label>
                        <input type="number" id="updateAmount" placeholder="100.00" step="0.01">
                    </div>
                </div>
                <button class="btn" onclick="updateBalance()">–û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                <div id="updateBalanceResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <div class="card">
            <div class="section">
                <h3>–í—Å–µ —Å—á–µ—Ç–∞</h3>
                <button class="btn" onclick="getAllAccounts()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞</button>
                <div class="loading" id="accountsLoading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div id="allAccountsResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div id="orders" class="tab-content">
        <div class="grid">
            <div class="card">
                <div class="section">
                    <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h3>
                    <div class="form-group">
                        <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="orderUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                    </div>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞</label>
                        <input type="number" id="orderAmount" placeholder="5.00" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="orderDescription" placeholder="Coca-cola">
                    </div>
                    <button class="btn" onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
                    <div id="createOrderResult" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="section">
                    <h3>–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑</h3>
                    <div class="form-group">
                        <label>ID –∑–∞–∫–∞–∑–∞</label>
                        <input type="text" id="getOrderId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞">
                    </div>
                    <button class="btn" onclick="getOrder()">–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑</button>
                    <div id="getOrderResult" class="result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section">
                <h3>–í—Å–µ –∑–∞–∫–∞–∑—ã</h3>
                <button class="btn" onclick="getAllOrders()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã</button>
                <div class="loading" id="ordersLoading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div id="allOrdersResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const API_CONFIG = {
        PAYMENT_SERVICE: 'http://localhost:8000/payment',
        ORDER_SERVICE: 'http://localhost:8000/order'
    };

    function openTab(evt, tabName) {
        const tabcontent = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }

        const tablinks = document.getElementsByClassName("tab");
        for (let i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    function showResult(elementId, message, isSuccess = true) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = `result ${isSuccess ? 'success' : 'error'}`;
        element.style.display = 'block';
    }

    function renderJsonPretty(data) {
        if (Array.isArray(data)) {
            return data.map(item => `<div class="json-card">${renderJsonPretty(item)}</div>`).join('');
        }

        if (typeof data === 'object' && data !== null) {
            return `
                <ul class="json-list">
                    ${Object.entries(data).map(([key, value]) => `
                        <li><strong>${key}:</strong> ${formatJsonValue(value)}</li>
                    `).join('')}
                </ul>
            `;
        }

        return `<span>${data}</span>`;
    }

    function formatJsonValue(value) {
        if (typeof value === 'object' && value !== null) {
            return renderJsonPretty(value);
        }
        return String(value);
    }

    function showJsonResult(elementId, data, isSuccess = true) {
        const element = document.getElementById(elementId);
        element.innerHTML = renderJsonPretty(data);
        element.className = `result ${isSuccess ? 'success' : 'error'}`;
        element.style.display = 'block';
    }

    async function createAccount() {
        const fullName = document.getElementById('fullName').value.trim();
        const balance = parseFloat(document.getElementById('balance').value) || 0;

        if (!fullName) {
            showResult('createAccountResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è', false);
            return;
        }

        try {
            const response = await fetch(`${API_CONFIG.PAYMENT_SERVICE}/account/create`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    full_name: fullName,
                    balance: balance
                })
            });

            const result = await response.text();

            if (response.ok) {
                showResult('createAccountResult', result);
                document.getElementById('fullName').value = '';
                document.getElementById('balance').value = '';
            } else {
                showResult('createAccountResult', `–û—à–∏–±–∫–∞: ${result}`, false);
            }
        } catch (error) {
            showResult('createAccountResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        }
    }

    async function getAccount() {
        const userId = document.getElementById('getUserId').value.trim();

        if (!userId) {
            showResult('getAccountResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
            return;
        }

        try {
            const response = await fetch(`${API_CONFIG.PAYMENT_SERVICE}/account/get/${userId}`);

            if (response.ok) {
                const data = await response.json();
                showJsonResult('getAccountResult', data);
            } else {
                const error = await response.text();
                showResult('getAccountResult', `–û—à–∏–±–∫–∞: ${error}`, false);
            }
        } catch (error) {
            showResult('getAccountResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        }
    }

    async function updateBalance() {
        const userId = document.getElementById('updateUserId').value.trim();
        const amount = parseFloat(document.getElementById('updateAmount').value);

        if (!userId) {
            showResult('updateBalanceResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
            return;
        }

        if (isNaN(amount) || amount === 0) {
            showResult('updateBalanceResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', false);
            return;
        }

        try {
            const response = await fetch(`${API_CONFIG.PAYMENT_SERVICE}/account/update/${userId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    amount: amount
                })
            });

            const result = await response.text();

            if (response.ok) {
                showResult('updateBalanceResult', result);
            } else {
                showResult('updateBalanceResult', `–û—à–∏–±–∫–∞: ${result}`, false);
            }
        } catch (error) {
            showResult('updateBalanceResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        }
    }

    async function getAllAccounts() {
        const loading = document.getElementById('accountsLoading');
        const result = document.getElementById('allAccountsResult');

        loading.style.display = 'block';
        result.style.display = 'none';

        try {
            const response = await fetch(`${API_CONFIG.PAYMENT_SERVICE}/account/get`);

            if (response.ok) {
                const data = await response.json();
                showJsonResult('allAccountsResult', data);
            } else {
                const error = await response.text();
                showResult('allAccountsResult', `–û—à–∏–±–∫–∞: ${error}`, false);
            }
        } catch (error) {
            showResult('allAccountsResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        } finally {
            loading.style.display = 'none';
        }
    }

    async function createOrder() {
        const userId = document.getElementById('orderUserId').value.trim();
        const amount = parseFloat(document.getElementById('orderAmount').value);
        const description = document.getElementById('orderDescription').value.trim();

        if (!userId) {
            showResult('createOrderResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
            return;
        }

        if (isNaN(amount) || amount <= 0) {
            showResult('createOrderResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', false);
            return;
        }

        if (!description) {
            showResult('createOrderResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞', false);
            return;
        }

        try {
            const response = await fetch(`${API_CONFIG.ORDER_SERVICE}/create/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    amount: amount,
                    descr: description
                })
            });

            const result = await response.text();

            if (response.ok) {
                showResult('createOrderResult', result);
                document.getElementById('orderUserId').value = '';
                document.getElementById('orderAmount').value = '';
                document.getElementById('orderDescription').value = '';
            } else {
                showResult('createOrderResult', `–û—à–∏–±–∫–∞: ${result}`, false);
            }
        } catch (error) {
            showResult('createOrderResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        }
    }

    async function getOrder() {
        const orderId = document.getElementById('getOrderId').value.trim();

        if (!orderId) {
            showResult('getOrderResult', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞', false);
            return;
        }

        try {
            const response = await fetch(`${API_CONFIG.ORDER_SERVICE}/get/${orderId}`);

            if (response.ok) {
                const data = await response.json();
                showJsonResult('getOrderResult', data);
            } else {
                const error = await response.text();
                showResult('getOrderResult', `–û—à–∏–±–∫–∞: ${error}`, false);
            }
        } catch (error) {
            showResult('getOrderResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        }
    }

    async function getAllOrders() {
        const loading = document.getElementById('ordersLoading');
        const result = document.getElementById('allOrdersResult');

        loading.style.display = 'block';
        result.style.display = 'none';

        try {
            const response = await fetch(`${API_CONFIG.ORDER_SERVICE}/get`);

            if (response.ok) {
                const data = await response.json();
                showJsonResult('allOrdersResult', data);
            } else {
                const error = await response.text();
                showResult('allOrdersResult', `–û—à–∏–±–∫–∞: ${error}`, false);
            }
        } catch (error) {
            showResult('allOrdersResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
        } finally {
            loading.style.display = 'none';
        }
    }
</script>
</body>
</html>